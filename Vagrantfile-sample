# -*- mode: ruby -*-
# vi: set ft=ruby :

ENV['ANSIBLE_CONFIG'] = "./ansible.cfg"

vagrant_network_ip = "192.168.56.100"

File.open('ansible/local/inventory' ,'w') do |f|
	f.write "#{vagrant_network_ip} ansible_ssh_user=vagrant ansible_ssh_private_key_file=.vagrant/machines/generic/virtualbox/private_key\n"
end

Vagrant.configure(2) do |config|

	#
	# Centos
	#
	config.vm.box = "centos/7"

	#
	# Network
	#
	config.vm.network "private_network", ip: "#{vagrant_network_ip}"

	#
	# Synced folder
	#
	# config.vm.synced_folder "~/Development/Websites", "/var/www", type: "nfs"
	config.vm.synced_folder "~/Development/Websites", "/var/www", mount_options: ["dmode=777,fmode=777"]

	#
	# Remove default options
	#
	config.vm.synced_folder ".", "/home/vagrant/sync", :disabled => true

	#
	# Virtual machine config
	#
	config.vm.define "generic" do |generic|
    	generic.vm.hostname = "genericvm.local"
    end

	#
	# VirtualBox config
	#
	config.vm.provider "virtualbox" do |virtualbox|
    	virtualbox.memory = 1024
    	virtualbox.customize ["modifyvm", :id, "--natdnshostresolver1", "off"]
    end

	#
	# Run Ansible from the Vagrant Host
	#
	config.vm.provision "ansible" do |ansible|
		ansible.inventory_path = "./ansible/local/inventory"
		ansible.playbook = "./ansible/provision.yml"
		ansible.limit = "all"
	end

	#
	# Additional scripts
	#
	config.vm.provision :shell, run: "always", path: "ansible/scripts/services.sh"

end
